<html>
<head>
<link href="styles/libstyle.css" rel="stylesheet" type="text/css" />
<script>
	// fetch from genesis
var threads = {
  "v": 3,
  "q": {
    "find": {
      "$text": { "$search": "b://" },
    "out.s1": "1P8FmmWdyRY1bmHJso6nGc7smBSvwvFoje"
     },
    "limit": 700,
  },
  "r": {
    "f": "[ .[] | { txid: .tx.h, img: .out[0].s5 }]"
  }
}

// parse it
var b64 = btoa(JSON.stringify(threads));
var url = "https://genesis.bitdb.network/q/1FnauZ9aUH2Bex6JzdcV4eNX7oLSSEbxtN/" + b64;
var header = {
  headers: { key: "14QX7pn5GbipWvNLyDfrdcZLzwvPYJSnhB" }
};
//
fetch(url, header).then(function(r) {
  return r.json()

}).then(function(r) {
  let res = r.u.concat(r.c)
  res.forEach(function(output) {
    var threadid = output.txid;
    var imglink = output.img;
    var image = document.createElement("div");
    image.id = (`${threadid}`);
    image.setAttribute('class', 'library');
   // image
    var img = document.createElement('img');
    var url = "https://bico.media/" + output.img;
    img.setAttribute("src", `${url}`);
     //
    image.innerHTML =
    "<img id=img" + threadid +" src=" + `${url}` + " class=libimg></img>"
    + "<textarea id=imglink" + threadid + " style='position:absolute;left:-1000px;top:-1000px;'>"
    + imglink + "</textarea>" +
    "<br />" +
    "<br />"
    + "</div>";
	document.body.appendChild(image);	
	// the actual textarea
	var copytext = document.getElementById("imglink" + threadid).value;
	var copytextarea = document.getElementById("imglink" + threadid);
    console.log(copytext)
	var copybutton = document.getElementById("img" + threadid);
	console.log("copybutton is:" + copybutton);
    copybutton.addEventListener("click", function (event) {
		copytextarea.select();
		document.execCommand("copy");
	  alert(copytext + " copied!");
	})
})
});
</script>
</head>
<body>

<div class="topnav">
	<a href="../index.html">index</a> 
	<a href="../about.html">about</a> 
	<a href="/boards/b.html">/b/</a> 
	<a href="/boards/pol.html">/pol/</a> 
	<a href="/boards/biz.html">/biz/</a> 
	<a href="/boards/tv.html">/tv/</a> 
	<a href="/boards/g.html">/g/</a> 
	<a href="/boards/a.html">/a/</a> 
	<a href="/boards/mu.html">/mu/</a>
	<a class="active" href="../library.html">image library</a>
	<center>
</div>
	<h1>Image Library 
  </h1>
  <br />
  </center>
  <br />
</body>
</html>	
