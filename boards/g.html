<!DOCTYPE html>
<html>
<head>
  <script src="https://www.moneybutton.com/moneybutton.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
	<script src='https://unpkg.com/datapay'></script>
	<script src='https://unpkg.com/databutton'></script>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link href="/manifest.json" rel="manifest" /><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff">
	<title>Haichan: A Peer-to-Peer Electronic Image Board</title>
	<link href="../styles/style.css" rel="stylesheet" type="text/css" />

<script>
var threads = {
  "v": 3,
  "q": {
    "db": ["u","c"],
    "find": {
    "out.s1": "1P8FmmWdyRY1bmHJso6nGc7smBSvwvFoje",
	"out.s2": "/g/",
	"out.s3": "THREAD",
     },
    "limit": 20,
  },
  "r": {
    "f": "[ .[] | { op: .in[0].e.a?, txid: .tx.h, timestamp: .blk.t?, txt: .out[0]?.s4, img: .out[0].s5 }]"
  }
}
var b64 = btoa(JSON.stringify(threads));

var url = "https://genesis.bitdb.network/q/1FnauZ9aUH2Bex6JzdcV4eNX7oLSSEbxtN/" + b64;
var header = {
  headers: { key: "14QX7pn5GbipWvNLyDfrdcZLzwvPYJSnhB" }
};
fetch(url, header).then(function(r) {
  return r.json()
}).then(function(r) {
  let res = r.u.concat(r.c)
  res.forEach(function(output) {
    var threadid = output.txid;
    var content = output.txt;
    var op = output.op
    console.log(`message is ${content}`);
    var thread = document.createElement("div");
    thread.id = (`${threadid}`);
    thread.setAttribute('class', 'thread');
    var opid = "replydone" + threadid;
    var img = document.createElement('img');
    var url = "https://bico.media/" + output.img;
    thread.innerHTML =
    "<button id=openreply>Reply</button>" + "<button id=seetx>Tx</button>"
    + "<button id=tipop" 
    + threadid + " class='tipop'>Tip" 
    // minimize thread
    //+ "<button class=minimize>[-]</button>" 
    + "<br />" +
    "<div id=optipsubmit" + threadid + " class='hidden'>" +
      "<div id=optipbutton" + threadid + " class='hidden'></div>" + "</div>"
      + "</button>" +
    "<button id=closetx class='hidden'>Close</button>" +
    "<br />" + "<button id=optipclose" + threadid +" class='hidden'>Close</button>" +
    "<p id=optx class='hidden'>" + threadid + "</p>" +
    "<div class='op'>" +
    "<img src=" + `${url}` + " class=pic></img>" +
    "<p class=threadtext>" +
    content + 
   "</p>" +
      "<hr />" +
      "<br />" +
      "<div id=replyop class='hidden'>" +
    "<textarea id=replyform placeholder='Type your reply...' class='hidden'></textarea>" +
    "<br />" +
    "<br />" +
    "<input id=replyimglink placeholder='b:// image link' class='hidden'></textarea>" +
    "<br />" +
    "<button href='#' id=replydone" + threadid + " class='hidden'>Post reply!</button>" +
      "<button href='#' id='closereply' style='center' class='hidden'>Close</button>" +
      "<br />" +
      "<div id='replysubmit' class='hidden'>" +
      "<br />" +
        "<div id=replybutton" + threadid + "></div>" +
          "</div>" +
          "</div>" +
          "</div>" +
      "</center>";
    document.body.appendChild(thread);

    //
    //
    //
    //
    //
    //
    thread.querySelector("#openreply").addEventListener("click", function(e) {
      thread.querySelector("#replyform").classList.remove('hidden')
      thread.querySelector("#replyop").classList.remove('hidden')
      thread.querySelector("#replyop").classList.add('replybox')
        thread.querySelector("#replyimglink").classList.remove('hidden')
        thread.querySelector("#replysubmit").classList.remove('hidden')
        thread.querySelector("#closereply").classList.remove('hidden')
        thread.querySelector("#replydone" + threadid).classList.remove('hidden')
        thread.querySelector("#openreply").classList.add('hidden')
    });
    thread.querySelector("#seetx").addEventListener("click", function(e) {
      thread.querySelector("#optx").classList.remove('hidden')
      thread.querySelector("#closetx").classList.remove('hidden')
    });
    thread.querySelector("#closetx").addEventListener("click", function(e) {
      thread.querySelector("#optx").classList.add('hidden')
      thread.querySelector("#closetx").classList.add('hidden')
    });
    thread.querySelector("#closereply").addEventListener("click", function(e) {
      thread.querySelector("#replyform").classList.add('hidden')
        thread.querySelector("#replyimglink").classList.add('hidden')
        thread.querySelector("#replysubmit").classList.add('hidden')
        thread.querySelector("#replydone" + threadid).classList.add('hidden')
        thread.querySelector("#openreply").classList.remove('hidden')
        thread.querySelector("#closereply").classList.add('hidden')
        thread.querySelector("#replyop").classList.add('hidden')
    })
    thread.querySelector("#replydone" + threadid).addEventListener("click", function(e) {
   	  databutton.build({
      data: ["1P8FmmWdyRY1bmHJso6nGc7smBSvwvFoje", "/g/", "REPLY", thread.querySelector("#replyform").value, thread.querySelector("#replyimglink").value, threadid],
      button: {
        $el: "#replybutton" + threadid,
        label: "",
        $pay: {
          to: [{
            address: "1LWQtHNozJ9Ffjehi869FKt3guXnRg3FZB",
            value: 5000
          }],
        },
        onPayment: function(e) {
          console.log("paid!", e)
          setTimeout(function() {
            feed()
          }, 1000)
        }
      }
    })
  });
  thread.querySelector("#tipop" + threadid).addEventListener("click", function(e) {
    thread.querySelector("#optipclose" + threadid).classList.remove('hidden')
    thread.querySelector("#optipsubmit" + threadid).classList.remove('hidden')
  });
  thread.querySelector("#optipclose" + threadid).addEventListener("click", function(e) {
    thread.querySelector("#optipbutton" + threadid).classList.add('hidden')
    thread.querySelector("#optipclose" + threadid).classList.add('hidden')
    thread.querySelector("#optipclose" + threadid).classList.remove('submitclose')
    thread.querySelector("#optipsubmit" + threadid).classList.add('hidden')
  });
  thread.querySelector("#tipop" + threadid).addEventListener("click", function(e) {
    thread.querySelector("#optipbutton" + threadid).classList.remove('hidden')
    thread.querySelector("#optipsubmit" + threadid).classList.add('submitclose')
    thread.querySelector("#optipclose" + threadid).classList.add('submitclose')
    const div = document.getElementById("optipbutton" + threadid);   
    moneyButton.render(div, {
      to: op,
      amount: "0.01",
      currency: "USD"
    })
  });
      var replies = {
        "v": 3,
        "q": {
          "db": ["u","c"],
          "find": {
          "out.s1": "1P8FmmWdyRY1bmHJso6nGc7smBSvwvFoje",
		  "out.s2": "/g/",
		  "out.s3": "REPLY",
          "out.s6": threadid
          },
          "limit": 100,
        },
        "r": {
          "f": "[ .[] | { replyp: .in[0].e.a?, replytxid: .tx.h, replystamp: .blk.t?, replytxt: .out[0].s4, replyimg: .out[0].s5, replyto: .out[0].s6 }]"
        }
      };
      var b64 = btoa(JSON.stringify(replies));
      var url = "https://genesis.bitdb.network/q/1FnauZ9aUH2Bex6JzdcV4eNX7oLSSEbxtN/" + b64;
      var header = {
        headers: { key: "14QX7pn5GbipWvNLyDfrdcZLzwvPYJSnhB" }
      };
      fetch(url, header).then(function(r) {
        return r.json()
      }).then(function(r) {
        let res = r.u.concat(r.c)
        res.forEach(function(output) {
          var replyp = output.replyp;
          replyto = output.replyto;
          replytxt = output.replytxt;
          replytxid = output.replytxid;
          var replyimg = document.createElement('img');
          replyimg.setAttribute('class', 'replyimg');
          var replyurl = "https://bico.media/" + output.replyimg
          replyimg.setAttribute("src", `${url}`);
          var replyto = document.getElementById(`${replyto}`);var replytext = document.createTextNode(`${output.replytxt}`);
          var reply = document.createElement("div");
          reply.setAttribute("class", "reply");
          reply.innerHTML =
          "<img src=" + `${replyurl}` + " class=replypic></img>" 
          + "<button id=replytip" + replyp +" class='replytip'>Tip" +
          "<div id=replytipsubmit" + replyp + " class='hidden'>"  +
          "<div id=replytipbutton" + replyp + " class='hidden'>" + "</div>" + "</div>" + "<br />" +

          "<button id=replytipclose" + replyp + " class='hidden'>Close</button>" +
        "</button>" +
          "<p id=replytext" + replytxid + " class='replytext'>" +
          "</p>" +
          "</p>";
          thread.appendChild(reply);
          thread.querySelector("#replytext" + replytxid).appendChild(replytext);
          thread.querySelector("#replytip" + replyp).addEventListener("click", function(e) {
          thread.querySelector("#replytipsubmit" + replyp).classList.remove('hidden')
          thread.querySelector("#replytipbutton" + replyp).classList.remove('hidden')
          thread.querySelector("#replytipsubmit" + replyp).classList.add('submitclose')
          thread.querySelector("#replytipclose" + replyp).classList.remove('hidden')
            const div = document.getElementById("replytipbutton" + replyp);   
          moneyButton.render(div, {
            to: replyp,
            amount: "0.01",
            currency: "USD"
          })
        });
        thread.querySelector("#replytipclose" + replyp).addEventListener("click", function(e) {
          thread.querySelector("#replytipsubmit" + replyp).classList.add('hidden')
          thread.querySelector("#replytipsubmit" + replyp).classList.remove('submitclose')
          thread.querySelector("#replytipbutton" + replyp).classList.add('hidden')
          thread.querySelector("#replytipclose" + replyp).classList.add('hidden')
        })
      });
    })
  });
});


</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
	document.querySelector("#done").addEventListener("click", function(e) {
    document.querySelector("#submit").classList.remove('hidden')
   	databutton.build({
      data: ["1P8FmmWdyRY1bmHJso6nGc7smBSvwvFoje", "/g/", "THREAD", document.querySelector("#newthread").value, document.querySelector("#imglink").value],
      button: {
        $el: "#button",
        label: "",
        $pay: {
          to: [{
            address: "1LWQtHNozJ9Ffjehi869FKt3guXnRg3FZB",
            value: 5000
          }],
        },
        onPayment: function(e) {
          console.log("paid!", e)
          setTimeout(function() {
            feed();
            window.reload();
          }, 1000)
        }
      }
    })
  })
})
</script>
</head>
<body>
<div class="topnav"><a href="../index.html">index</a> 
<a href="../about.html">about</a> 
<a href="/boards/b.html">/b/</a> 
<a href="/boards/pol.html">/pol/</a> 
<a href="/boards/biz.html">/biz/</a> 
<a href="/boards/tv.html">/tv/</a> 
<a class="active" href="/boards/g.html">/g/</a> 
<a href="/boards/a.html">/a/</a> 
<a href="/boards/mu.html">/mu/</a>
<a href="../library.html">image library</a></div>
<h1 class="glow"><span>/g/ - Technology</span></h1>
<center>
<form>
    <textarea id="newthread" placeholder="Post a new thread..." required minlength="1"></textarea>
    <br />
		<input id="imglink" placeholder="b:// image link" required minlength="68" required maxlength="68" required maxlength="68" required pattern="b://.{64}"></textarea>
    
    <script>
        (function() {
          $('form > input').keyup(function() {
        
            var empty = false;
            $('form > input').each(function() {
              if ($(this).val() == '') {
                empty = true;
              }
            });
        
            if (empty) {
              $('#done').attr('disabled', 'disabled');
            } else {
              $('#done').removeAttr('disabled');
            }
          });
        })()
        </script>
  </form>
  <button id="done" href="#" class="post" disabled="disabled")>Post
      <div id='submit' class='hidden'>
          <div id='button'></div>
          </div>
  </button>
</center>
<h2><span style="font-family:courier new,courier,monospace;">Threads:</span></h2>
</body>
</html>
        